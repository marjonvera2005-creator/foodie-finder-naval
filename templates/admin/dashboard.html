<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Foodie Finder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { margin: 0; font-family: 'Poppins', sans-serif; }
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 250px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 1000;
            overflow-y: auto;
        }
        .sidebar .nav-link {
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 5px 10px;
            transition: all 0.3s;
        }
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        .main-content {
            margin-left: 250px;
            background: url('/static/img/background.jpg') center/cover no-repeat fixed, #f8f9fa;
            min-height: 100vh;
            padding: 20px;
        }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn-action {
            padding: 5px 10px;
            margin: 2px;
            border-radius: 5px;
            border: none;
            font-size: 12px;
        }
        .btn-approve { background: #28a745; color: white; }
        .btn-reject { background: #dc3545; color: white; }
        .btn-delete { background: #6c757d; color: white; }
        @media (max-width: 768px) {
            .sidebar { left: -250px; transition: left 0.3s; }
            .sidebar.show { left: 0; }
            .main-content { margin-left: 0; }
            .mobile-toggle {
                position: fixed;
                top: 15px;
                left: 15px;
                z-index: 1060;
                background: #667eea;
                color: white;
                border: none;
                padding: 10px;
                border-radius: 5px;
            }
        }
        @media (min-width: 769px) { .mobile-toggle { display: none; } }
    </style>
</head>
<body>
    <button class="mobile-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
    
    <div class="sidebar" id="sidebar">
        <div class="p-3 text-center">
            {% load static %}
            <img src="{% static 'img/LOGO.png' %}" alt="Logo" style="width: 80px; height: 80px; object-fit: contain; margin-bottom: 15px;">
            <h4 class="text-white mb-4">Admin Panel</h4>
            <nav class="nav flex-column">
                <a class="nav-link active" href="#" onclick="showSection('dashboard')"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                <a class="nav-link" href="#" onclick="showSection('restaurants')"><i class="fas fa-store"></i> Restaurants</a>
                <a class="nav-link" href="#" onclick="showSection('users')"><i class="fas fa-users"></i> Users</a>
                <a class="nav-link" href="{% url 'main' %}"><i class="fas fa-home"></i> Foodie Site</a>
                <hr class="text-white">
                <a class="nav-link" href="{% url 'admin-logout' %}"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </nav>
        </div>
    </div>

    <div class="main-content">
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="content-section active">
            <h2 class="mb-4">Dashboard Overview</h2>
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card text-white bg-primary">
                        <div class="card-body text-center">
                            <i class="fas fa-store fa-2x mb-2"></i>
                            <h5>Restaurants</h5>
                            <h3>{{ stats.restaurants|default:0 }}</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-white bg-success">
                        <div class="card-body text-center">
                            <i class="fas fa-utensils fa-2x mb-2"></i>
                            <h5>Dishes</h5>
                            <h3>{{ stats.dishes|default:0 }}</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-white bg-info">
                        <div class="card-body text-center">
                            <i class="fas fa-users fa-2x mb-2"></i>
                            <h5>Users</h5>
                            <h3>{{ stats.users|default:0 }}</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-white bg-warning">
                        <div class="card-body text-center">
                            <i class="fas fa-clock fa-2x mb-2"></i>
                            <h5>Pending</h5>
                            <h3>{{ stats.pending_users|default:0 }}</h3>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header"><h5><i class="fas fa-store"></i> Recent Restaurants</h5></div>
                        <div class="card-body">
                            {% for resto in recent_restos %}
                            <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                                <div>
                                    <h6 class="mb-0">{{ resto.name }}</h6>
                                    <small class="text-muted">{{ resto.category }} - {{ resto.location }}</small>
                                </div>
                            </div>
                            {% empty %}
                            <p class="text-muted">No restaurants yet.</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header"><h5><i class="fas fa-users"></i> Recent Users</h5></div>
                        <div class="card-body">
                            {% for user_item in users|slice:":5" %}
                            <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                                <div>
                                    <h6 class="mb-0">{{ user_item.get_full_name|default:user_item.username }}</h6>
                                    <small class="text-muted">{{ user_item.email }}</small>
                                </div>
                                <span class="badge bg-{% if user_item.is_active %}success{% else %}secondary{% endif %}">
                                    {% if user_item.is_active %}Active{% else %}Inactive{% endif %}
                                </span>
                            </div>
                            {% empty %}
                            <p class="text-muted">No users yet.</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Restaurants Section -->
        <div id="restaurants-section" class="content-section">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Restaurant Management</h2>
                <a href="{% url 'admin-restaurant-create' %}" class="btn btn-primary"><i class="fas fa-plus"></i> Add Restaurant</a>
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Restaurant</th>
                                    <th>Category</th>
                                    <th>Location</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for restaurant in all_restaurants %}
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            {% if restaurant.thumbnail %}
                                            <img src="{{ restaurant.thumbnail.url }}" alt="{{ restaurant.name }}" class="rounded me-2" style="width: 40px; height: 40px; object-fit: cover;">
                                            {% endif %}
                                            <div>
                                                <strong>{{ restaurant.name }}</strong>
                                                <br><small class="text-muted">{{ restaurant.dishes.count }} dishes</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td><span class="badge bg-secondary">{{ restaurant.category }}</span></td>
                                    <td>{{ restaurant.location }}</td>
                                    <td>
                                        {% if restaurant.is_approved %}
                                        <span class="badge bg-success">Approved</span>
                                        {% else %}
                                        <span class="badge bg-warning">Pending</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{% url 'admin-restaurant-edit' restaurant.pk %}" class="btn btn-action btn-primary"><i class="fas fa-edit"></i></a>
                                        {% if not restaurant.is_approved %}
                                        <form method="post" action="{% url 'admin-restaurant-approve' restaurant.pk %}" class="d-inline">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-action btn-approve"><i class="fas fa-check"></i></button>
                                        </form>
                                        {% endif %}
                                        <form method="post" action="{% url 'admin-restaurant-delete' restaurant.pk %}" class="d-inline" onsubmit="return confirm('Delete this restaurant?')">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-action btn-delete"><i class="fas fa-trash"></i></button>
                                        </form>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="5" class="text-center text-muted py-4">
                                        <i class="fas fa-store fa-3x mb-3 d-block"></i>
                                        <h5>No restaurants found</h5>
                                        <a href="{% url 'admin-restaurant-create' %}" class="btn btn-primary">Add Restaurant</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Users Section -->
        <div id="users-section" class="content-section">
            <h2 class="mb-4">User Management</h2>
            {% if pending_users %}
            <div class="card mb-4">
                <div class="card-header"><h5><i class="fas fa-clock text-warning"></i> Pending Approvals</h5></div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr><th>Name</th><th>Email</th><th>Role</th><th>Actions</th></tr>
                            </thead>
                            <tbody>
                                {% for user in pending_users %}
                                <tr>
                                    <td>{{ user.get_full_name|default:user.username }}</td>
                                    <td>{{ user.email }}</td>
                                    <td>
                                        {% if user.profile %}
                                        <span class="badge bg-secondary">{{ user.profile.get_role_display }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <form method="post" action="{% url 'admin-user-approve' user.pk %}" class="d-inline">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-action btn-approve">Approve</button>
                                        </form>
                                        <form method="post" action="{% url 'admin-user-reject' user.pk %}" class="d-inline" onsubmit="return confirm('Reject this user?')">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-action btn-reject">Reject</button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}
            <div class="card">
                <div class="card-header"><h5><i class="fas fa-users text-primary"></i> All Users</h5></div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr><th>Name</th><th>Email</th><th>Role</th><th>Status</th><th>Joined</th><th>Actions</th></tr>
                            </thead>
                            <tbody>
                                {% for user in users %}
                                <tr>
                                    <td>{{ user.get_full_name|default:user.username }}</td>
                                    <td>{{ user.email }}</td>
                                    <td>
                                        {% if user.profile %}
                                        <span class="badge bg-{% if user.profile.role == 'admin' %}danger{% elif user.profile.role == 'restaurant' %}warning{% else %}primary{% endif %}">
                                            {{ user.profile.get_role_display }}
                                        </span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="badge bg-{% if user.is_active %}success{% else %}secondary{% endif %}">
                                            {% if user.is_active %}Active{% else %}Inactive{% endif %}
                                        </span>
                                    </td>
                                    <td>{{ user.date_joined|date:"M d, Y" }}</td>
                                    <td>
                                        {% if user.pk != request.user.pk %}
                                        <form method="post" action="{% url 'admin-user-delete' user.pk %}" class="d-inline" onsubmit="return confirm('Delete this user?')">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-action btn-delete"><i class="fas fa-trash"></i></button>
                                        </form>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showSection(sectionName) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById(sectionName + '-section').classList.add('active');
            event.target.classList.add('active');
            if (window.innerWidth <= 768) document.getElementById('sidebar').classList.remove('show');
        }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('show'); }
    </script>
</body>
</html>